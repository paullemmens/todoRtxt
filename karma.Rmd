---
title: 'Overview of todo performance alla Todoist Karma'
output:
  knitrBootstrap::bootstrap_document:
    theme: default
    highlight: 'visual studio'
    theme.chooser: false
    highlight.chooser: false
    clean_supporting: true
---

```{r set-options-read-chunks, echo=FALSE, message=FALSE, warning=FALSE, bootstrap.show.code = FALSE}
knitr::opts_chunk$set(results = 'markup', echo=FALSE, message=FALSE, warning=TRUE, dev=c('CairoSVG'), 
                      bootstrap.show.code=FALSE)
options(width=120)
library(tidyverse)
library(ggplot2)
library(lemmens)
devtools::load_all()
palette <- 'Dark2'
```

```{r load-data}
loc <- '~/nextcloud/todo/'
tasks <- load_tasks(file.path(loc, 'todo.txt'))
done <- load_tasks(file.path(loc, 'done.txt'))
done_old <- load_tasks(file.path(loc, 'done - 2018-07-21.txt'))
tl <- bind_rows(tasks, done, done_old)
```

# Tasks completed per week

```{r completed-per-week}
tl %>%
  mutate(week = as.numeric(format(date_completed, '%V')),
         year = as.numeric(format(date_created, '%Y'))) %>%
  filter(!is.na(done)) %>%
  count(year, week) %>%
  filter(!is.na(week)) %>%
  ggplot(mapping = aes(x = week, y = n)) +
    geom_line(aes(group = 1), size = 1.0) +
    facet_wrap(~ year) +
    labs(x = '\nWeek number', y = 'Number of task completed\n',
         title = 'Number of tasks completed per week\n') +
    theme_lemmens +
    theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
```

FIXME: build function to fill years / weeks before plotting (in particular but also useful in general)

build something to group by contexts and projects (or tags in general) to facilitate plotting and doing stuff
per context.

Discovered that I've seem to lost about two and a half years worth of old tasks.

```{r completed-per-week-context, eval = F}
# This is more complicated because of the tasks having multiple lists or tags.
tl %>% mutate(week = format(d.compl, '%V')) %>% filter(is.na(done), !is.na(week)) %>%
  group_by(lst, tag, week) %>% summarize(taskcount = n()) %>%
  ggplot(mapping = aes(x = week, y = taskcount, colour = tag, linetype = list)) +
    geom_line(size = 1.2) +
    labs(x = 'Week number', y = 'Number of task completed',
         title = 'Number of tasks completed per week\n') +
    scale_colour_brewer(type = 'qual', palette = palette) +
    mytheme + theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 1))
#tl %>% mutate() %>% group_by(list, tag, week) %>% summarize(no.tasks = n()) %>%
#  ggplot()
```

lag between entered and due

# Timeliness of completion

```{r due-done-lag}
tl %>%
  filter(!is.na(done)) %>% 
  mutate(due_lag = date_completed - date_due) %>%
  group_by(lst, tag) %>% use_series(due.lag)  %>% mean_cl_boot(due.lag)
```
lag between due and done


# Topics

```{r topics-over-time, eval = F}
tl %>%
  mutate(week = format(date_created, '%V'),
         year = format(date_created, '%Y')) %>%
  mutate(yw = as.numeric(paste0(year, week))) %>%
  group_by_context() %>%
    group_by_project() %>%
      ggplot(mapping = aes(x = yw, y = project, colour = context)) +
        geom_line() +
        labs(x = '\nDate', y = 'Project tag\n') +
        theme_lemmens + lemmens_brewer()
```
